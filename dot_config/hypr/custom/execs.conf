# You can make apps auto-start here
# Relevant Hyprland wiki section: https://wiki.hyprland.org/Configuring/Keywords/#executing

# XDG Desktop Portal (required for screensharing, file pickers, etc.)
# Per Hyprland FAQ: Portals should launch after Hyprland is fully initialized
# Using a delayed start to prevent apps taking a long time to open
exec-once = sleep 4 && /usr/lib/xdg-desktop-portal-hyprland
exec-once = sleep 6 && /usr/lib/xdg-desktop-portal

# Mega cloud storage - uncomment if you want it auto-started
# exec-once = DO_NOT_UNSET_QT_QPA_PLATFORMTHEME=1 DO_NOT_SET_DESKTOP_SETTINGS_UNAWARE=1 QT_QPA_PLATFORM=xcb megasync --minimized

# Start ABDownloadManager on login
# exec-once = /opt/ABDownloadManager/bin/ABDownloadManager --minimized

# Start Handy App
exec-once = handy

exec-once = kdeconnect-indicator

# Network and Bluetooth applets
exec-once = nm-applet --indicator
exec-once = blueman-applet

# ActivityWatch - Time tracking
# 
# NOTE: aw-qt requires a StatusNotifierWatcher on D-Bus (system tray).
# Quickshell provides a system tray, but Qt apps check for it BEFORE the tray
# is fully registered, causing the "no system tray" error.
# 
# FIX: Delay aw-qt startup to allow Quickshell's tray to register on D-Bus first.
# The dbus-wait loop checks every 0.5s for the StatusNotifierWatcher.
#
exec-once = bash -c 'sleep 5; while ! dbus-send --session --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.NameHasOwner string:org.kde.StatusNotifierWatcher 2>/dev/null | grep -q "boolean true"; do sleep 0.5; done; aw-qt'

# Alternative: Run ActivityWatch without system tray (headless mode)
# If you still get tray errors, comment out the line above and uncomment these:
# exec-once = aw-server
# exec-once = sleep 2 && aw-watcher-afk
# exec-once = sleep 2 && aw-watcher-window

# Start vinci short cut
exec-once = vicinae server
